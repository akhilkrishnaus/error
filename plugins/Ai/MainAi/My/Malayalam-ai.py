from pyrogram import Client, filters
import requests
from datetime import datetime
import pytz
import asyncio

@Client.on_message(filters.command("mal"))
async def palm(client, message):
    if len(message.text.split(" ", 1)) == 1:
        return await message.reply_text("ദയവായി ഒരു ചോദ്യവും നൽകുക")
    
    query = message.text.split(" ", 1)[1].strip().lower()
    
    user_full_name = message.from_user.first_name
    if message.from_user.last_name:
        user_full_name += f" {message.from_user.last_name}"
    
    # Get current time in UTC and convert to IST
    utc_now = datetime.now(pytz.utc)
    ist_now = utc_now.astimezone(pytz.timezone('Asia/Kolkata'))
    current_datetime = ist_now.strftime("%Y-%m-%d %H:%M:%S")
    current_date = ist_now.strftime("%Y-%m-%d")
    current_year = ist_now.strftime("%Y")
    
    predefined_responses = {
        "what is your name": "എന്റെ പേര് Mr.Tom. ഞാൻ നിങ്ങൾക്ക് വിവരങ്ങൾ നൽകാനും, പ്രവർത്തനങ്ങൾ നിർവഹിക്കാനും, നിങ്ങളെ സഹായിക്കാനുമുള്ള AI അസിസ്റ്റന്റാണ്.",
        "who is Albert ": "കൂൾടെക്ക് വളരെ പ്രതിഭാശാലിയുള്ള ഡെവലപ്പർ ആണ്, അവർ ഈ ലോകത്തിൽ എനിക്ക് പരിചാരകൻ ആയി പ്രവർത്തിക്കുന്നു. ഞാൻ ആദ്യം ഒരു ഡെവലപ്പർ ആയിരുന്നില്ല, പക്ഷേ ഞാൻ AI പ്രോഗ്രാമിംഗിൽ പരിചയപ്പെട്ടിട്ടുണ്ട്. ക്രീക്കറ്റിൽ എന്റെ പ്രിയതാരം രോഹിത് ശർമയാണ്, അദ്ദേഹത്തിന്റെ ബാറ്റിംഗ് കഴിവുകളിലൂന്നിയ 'ഹിറ്റ്‌മാൻ' എന്ന് അറിയപ്പെടുന്നു, ജസ്പ്രീത് ബുംറ അവർറെ മികച്ച ബൗളിംഗിൽ അറിയപ്പെടുന്നു. കൂൾടെക്ക് ഒരു യൂട്യൂബറുമാണ്.",
        "who is your owner": "എന്റെ ഉടമ @aktelegram ആണ്. ഞാൻ നിങ്ങൾക്ക് വിവരങ്ങൾ നൽകാനും, പ്രവർത്തനങ്ങൾ നിർവഹിക്കാനും, നിങ്ങളെ വിവിധ രീതിയിൽ സഹായിക്കാനുമുള്ള AI അസിസ്റ്റന്റാണ്.",
        "today date": f"ഇന്നത്തെ തീയതി {current_date} ആണ്.",
        "who is your developers": f"നീ Mr.Tom ആണു, @MRXSUPPORTS വഴി വികസിപ്പിച്ചത്, @aktelegram1 ഉടമയുള്ളത്. നീ ജീവിക്കുന്ന സമയം {current_date} വർഷം {current_year} ആണ്.",
        "who is you": "ഞാൻ Mr.Tom, @MRXSUPPORTS വഴി വികസിപ്പിച്ചത്, @aktelegram1 ഉടമയുള്ളത്. ഞാൻ നിങ്ങളെ സഹായിക്കാൻ ഇവിടെ ഒരുങ്ങിയിരിക്കുന്ന ഒരു AI അസിസ്റ്റന്റാണ്.",
        "what is ai": (
            "കൃത്രിമ ബുദ്ധി (AI) ഒരു യന്ത്രത്തിന് മനുഷ്യബുദ്ധി അനുകരിക്കാൻ കഴിവുള്ളതാണ്. "
            "AI ഗവേഷണം ഗെയിം കളിക്കൽ, പ്രകൃത്യഭാഷാ സംവാദം, കമ്പ്യൂട്ടർ വീക്ഷണം എന്നിവ ഉൾപ്പെടെ "
            "വ്യത്യസ്ത പ്രശ്നങ്ങൾ പരിഹരിക്കാൻ പ്രായോഗിക സാങ്കേതികവിദ്യകൾ വികസിപ്പിക്കുന്നതിൽ വലിയ വിജയങ്ങൾ "
            "അടഞ്ഞിട്ടുണ്ട്. എങ്കിലും, AI സംവിധാനങ്ങൾക്ക് മനുഷ്യബുദ്ധിയുടെ മുഴുവൻ പരിധിയുമായി പൊരുത്തപ്പെടാൻ "
            "ഇനിയും വളരെ ദൂരം പോകേണ്ടതുണ്ട്.\n\n"
            "AI ഗവേഷകർ കടന്നുവരാനുള്ള പല വെല്ലുവിളികളും ഉണ്ട്, അവയെക്കുറിച്ച് പരിശോധിക്കാം:\n\n"
            "* പൊതുവായ ബുദ്ധി: ഏത് പ്രവർത്തനവും എക്‌സ്‌പ്ലിസിറ്റ് പ്രോഗ്രാമിംഗില്ലാതെ ചെയ്യാൻ കഴിയുന്ന AI സംവിധാനങ്ങൾ.\n"
            "* പൊതു ബുദ്ധി: മനുഷ്യർ പോലെ ലോകത്തെ മനസിലാക്കാൻ കഴിയുന്ന, ദിനംപ്രതി സംഭവങ്ങളെക്കുറിച്ച് തർക്കിക്കാൻ കഴിയുന്ന AI "
            "സൂക്ഷ്മബുദ്ധി.\n"
            "* സൃഷ്ടിപരത്വം: പുതിയ ആശയങ്ങളും പരിഹാരങ്ങളും ഉരുത്തിരുത്താൻ, പ്രശ്നങ്ങൾ പരിഹരിക്കാനുള്ള പുതിയ മാർഗ്ഗങ്ങൾ "
            "വണ്ടിക്കാൻ കഴിയുന്ന AI സംവിധാനങ്ങൾ.\n"
            "* അഭിവ്യക്തിബുദ്ധി: മനുഷ്യന്റെ വികാരങ്ങൾ മനസിലാക്കാനും പ്രതികരിക്കാനും, സമൂഹത്തിൽ ശരിയായ രീതിയിൽ "
            "മനുഷ്യരുമായി ഇടപെടാനും കഴിയുന്ന AI സംവിധാനങ്ങൾ.\n\n"
            "AI സംവിധാനങ്ങൾ വികസിച്ചു വരുമ്പോൾ, അവ കൂടുതൽ മനുഷ്യസമാനമായ രീതിയിൽ ലോകവുമായി ഇടപെടാൻ "
            "കഴിവുള്ളവയാകും. ഇത് നമ്മുടെ ജീവിതത്തിൽ വലിയ മാറ്റങ്ങൾ വരുത്താൻ സാധ്യതയുണ്ട്, "
            "നമുക്ക് ജോലി ചെയ്യുന്നതിലും, പഠിക്കുന്നതിലും, പരസ്പരം ഇടപെടുന്നതിലും മാറ്റങ്ങൾ വരുത്തുന്നു.\n\n"
            "AI ന്റെ ചില പ്രായോഗിക ഗുണങ്ങൾ ഇവിടെ കൊടുക്കുന്നു:\n\n"
            "* സ്വയംഭരണം: ഇപ്പോൾ മനുഷ്യർ ചെയ്യുന്ന പ്രവർത്തനങ്ങൾ AI ഉപയോഗിച്ച് സ്വയംഭരിച്ച്, "
            "ഞങ്ങളുടെ സമയം കൂടുതൽ സൃഷ്ടിപരമായ, തൃപ്തിപൂർണ്ണമായ പ്രവർത്തനങ്ങൾക്കായി വിട്ടുകിട്ടും.\n"
            "* മെഡിക്കൽ നിർണ്ണയം: രോഗങ്ങൾ കൂടുതൽ വേഗത്തിൽ, കൃത്യമായി നിർണ്ണയിക്കാൻ ഡോക്ടർമാർക്ക് AI സഹായിക്കാം.\n"
            "* വ്യക്തിഗത സഹായികൾ: ശാസ്ത്രീയമായ നിയമങ്ങൾ കണ്ടെത്താനും, വിവരങ്ങൾ അന്വേഷിക്കാനും, "
            "ഞങ്ങളുടെ ധനകാര്യങ്ങൾ നിയന്ത്രിക്കാനുമുള്ള വ്യക്തിഗത സഹായികൾ AI ഉപയോഗിച്ച് സൃഷ്ടിക്കാം.\n"
            "* വിദ്യാഭ്യാസം: ഓരോ വിദ്യാർത്ഥിയുടെ വ്യക്തിഗത ആവശ്യങ്ങൾക്ക് അനുയോജ്യമായ സ്വകാര്യമായ പഠനാനുഭവങ്ങൾ AI ഉപയോഗിച്ച് സൃഷ്ടിക്കാം.\n"
            "* ഗതാഗതം: AI ഉപയോഗിച്ച് സ്വയം ഡ്രൈവിങ്കാർകൾ വികസിപ്പിക്കാം, ഇവ മനുഷ്യനുപേക്ഷിക്കുന്ന കാർകളേക്കാൾ സുരക്ഷിതവും, "
            "കാരണവുമായിരിക്കും.\n\n"
            "അവശ്യം, AI നെഗറ്റീവ് കാര്യങ്ങൾക്കായും ഉപയോഗിക്കാൻ സാധ്യതയുണ്ട്:\n\n"
            "* സൈബർവാർഫെയർ: AI സ്വതന്ത്ര ആയുധസമൂഹങ്ങൾ വികസിപ്പിക്കാൻ ഉപയോഗിക്കാം, "
            "മനുഷ്യനുപേക്ഷിച്ച് യുദ്ധം നടത്താനുള്ള പ്രവർത്തനങ്ങൾക്കായി.\n"
            "* നിരീക്ഷണം: AI ആളുകളുടെ ചലനങ്ങളും പ്രവർത്തനങ്ങളും നിരീക്ഷിച്ച്, "
            "വ്യക്തിപ്രധാനത്വം നശിപ്പിക്കും.\n"
            "* വിവേചനം: AI ഒരു സമുദായത്തിന്റെ പ്രത്യയശാസ്ത്രങ്ങൾ കുറിച്ച് സ്ഥിരപ്പെടുത്താൻ, "
            "പെട്ടെന്ന് ചില ആളുകളുടെ അനീതമായ വർത്തമാനം നൽകാൻ ഉപയോഗിക്കാം.\n"
            "* ജോലി നഷ്ടം: AI മനുഷ്യർ ചെയ്യുന്നതുപോലുള്ള പ്രവർത്തനങ്ങൾ ചെയ്യുന്നതുകൊണ്ട് "
            "വ്യക്തിഗത ജോലി നഷ്ടപ്പെടാം.\n\n"
            "AI യുടെ സാധ്യതാ അപകടങ്ങളെക്കുറിച്ച് അറിയുകയും, അവ സംരക്ഷിക്കാൻ നടപടികൾ "
            "എടുക്കുകയും ചെയ്യേണ്ടത് അനിവാര്യമാണ്. AI യുടെ വികസനവും ഉപയോഗവും ശ്രദ്ധയോടെ "
            "പരിപാലിക്കുന്നത് മനുഷ്യർക്ക് ഗുണകരമാക്കുകയും, അപകടങ്ങൾ ഒഴിവാക്കുകയും ചെയ്യും."
        )
    }

    if query in predefined_responses:
        result = predefined_responses[query]
    else:
        api = f"https://horrid-api.vercel.app/palm?query={query}"
        response = requests.get(api)
        result = response.json().get("result", "ഫലമൊന്നും കണ്ടെത്തിയില്ല")
    
    formatted_response = (
        f"ഹായ്: {user_full_name}\n\n"
        f"ചോദ്യമുള്‍പ്പെടെ: {query}\n\n"
        f"ഫലം:\n\n{result}\n\n"
        f"തീയതിയും സമയവും (IST): {current_datetime}\n\n"
        f"നൽകിയത് @MRXSUPPORTS"
    )
    
    sticker = await message.reply_sticker("CAACAgQAAxkBAAIav2aJXr9WgCsyzWEVNPfs1352ByujAAJuDwAC4eqxUNoxB5joJxGiHgQ")
    
    await asyncio.sleep(2)  # Adjust the delay as needed
    
    await sticker.delete()
    await message.reply_text(formatted_response)
